\begin{center}
\begin{minipage}{\textwidth}
\begin{lstlisting}[mathescape, linewidth=11.4cm]
constants:        meBit:=$2^\mathit{threadIndex}$, full:=$\sum_{i=0}^{\mathit{threadCount}-1}2^i$
local variables:  integer copy
shared variables: integer entry, exit, boolean left
initialisation:   entry := 0, exit := 0, left := false
$\listingrule{11.4cm}$

if left = false {

	do {
		copy := (copy $\&$ $\sim$meBit) | entry
		if copy $\&$ meBit = 0 {
			copy  := copy | meBit
			entry := copy
		}
	} while copy $\neq$ full and left = false

	left := true
	exit := 0

} else if left = true {

	do {
		copy := (copy $\&$ $\sim$meBit) | exit
		if copy $\&$ meBit = 0 {
			copy := copy | meBit
			exit := copy
		}
	} while copy $\neq$ full and left = true

	left  := false
	entry := 0
}
\end{lstlisting}
\end{minipage}
\end{center}
