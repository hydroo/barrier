\begin{center}
\begin{minipage}{\textwidth}
\begin{lstlisting}[mathescape, linewidth=11.8cm]
constants:        me := processIndex
shared variables: boolean
                  barrier[processCount][processCount]
local variables:  integer dist
initialization:   barrier[*][*] := false
$\listingrule{11.8cm}$

for dist := 1; dist < processCount; dist := dist $\cdot$ 2 {
	to   := (me + dist) (mod processCount)
	from := (me - dist) (mod processCount)
	
	barrier[to][me] := true
	
	wait until barrier[me][from] = true
}
\end{lstlisting}
\end{minipage}
\end{center}
