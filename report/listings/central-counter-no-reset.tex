\begin{lstlisting}[mathescape]
shared variables: integer barrier := threadCount
$\listingrule$

atomic{barrier := barrier - 1}

wait until barrier = 0
\end{lstlisting}
