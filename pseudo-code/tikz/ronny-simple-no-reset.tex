%
% does not 100% reflect the prism model
%

\input{pre}

% preamble
\node [box, align=left] (pre)  {
	\begin{minipage}{12cm}
		\begin{itemize}
			\item constants:
				\begin{itemize}
					\item[] \textbf{integer} nthreads {\color{gray} number of threads}
					\item[] \textbf{integer} me \color{gray} thread identificator (0..nthreads-1)
				\end{itemize}
			\item shared variables:
				\begin{itemize}
					\item[] \textbf{boolean} barrier[0..nthreads-1] \color{gray}each element on an own cacheline
				\end{itemize}
			\item local variables:
				\begin{itemize}
					\item[] \textbf{integer} i
				\end{itemize}
			\item initialize:
				\begin{itemize}
					\item[] barrier[*] := false
					\item[] i := 0
				\end{itemize}
		\end{itemize}
	\end{minipage}
};

% nodes
\node [o, below of=pre, draw=none, yshift=-2cm]  (init) {};
\node [o, below of=init]                         (1)    {};
\node [o, below of=1]                            (2)    {};
\node [o, below of=2]                            (3)    {};
\node [o, below of=3, draw=none]                 (done) {};

%  edges
\path [->] (init) edge                                      node       {\color{gray}(work period)}                                (1);
\path [->] (1)    edge                                      node       {barrier[me] := true \color{gray}(shared write)}           (2);
\path [->] (2)    edge [loop, distance=2cm, out=45, in=-45] node       {barrier[i] $\ne$ true : i := 0 \color{gray}(shared read)} (2);
\path [->] (2)    edge                                      node       {else : i := i + 1 \color{gray}(shared read)}              (3);
\path [->] (3)    edge [out=180, in=180]                    node[left] {i $<$ nthreads}                                           (2);
\path [->] (3)    edge                                      node       {else}                                                     (done);

\input{post}

